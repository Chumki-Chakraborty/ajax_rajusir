<!DOCTYPE html>
<html>

<head>
    <title>User Info</title>
    <style type="text/css">
        body {
            background-color: lightblue;
        }
    </style>
    <link rel="stylesheet" href="stylesheets/style.css">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.6.2/dist/css/bootstrap.min.css"
        integrity="sha384-xOolHFLEh07PJGoPkLv1IbcEPTNtaed2xpHsD9ESMhqIYd0nLMwNLD69Npy4HI+N" crossorigin="anonymous">

    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.2.1/jquery.min.js">
    </script>
    <script type="text/javascript">
        $(document).ready(function () {
            console.log('jquery call or not');

            //****Add user data**********
            $("#form1").submit(function (event) {
                event.preventDefault();
                //alert('ddddd')
                $.ajax({
                    type: 'POST',
                    url: '/ajax/create/user',
                    data: $('#form1').serialize(),
                    dataType: "json",
                    success: function (response) {
                        clearInputs();
                         Show();
                        console.log('data added');
                        console.log(response);
                        //$( "#a" ).click();
                    },
                    error: function (erorr) {
                        console.log(erorr);
                    }
                })
            });

            //********afetr submit the data clear formvalue******

            function clearInputs() {
                $("#username").val('');
                $("#fullname").val('');
                $("#age").val('');
            }

            //**********for Show data*****************
            $("#adata").click(function () {
                Show();
            });

            function Show() {
                console.log('show data call');
                $.ajax({
                    type: 'GET',
                    url: '/ajax/show/userdata',
                    dataType: "json",
                    success: function (data) {
                        console.log(data);
                        {
                            var html = '';
                            if (data.data.length > 0) {
                                for (var count = 0; count < data.data.length; count++) {
                                    html += `
                        <tr>
                            <td>`+ data.data[count].username + `</td>
                            <td>`+ data.data[count].fullname + `</td>
                            <td>`+ data.data[count].age + `</td>
                            // <td><button type="button" class="btn btn-danger btn-sm delete" data-id="` + data.data[count]._id + `">Delete</button></td>
                        </tr>
                        `;
                                }
                            }

                            $('#sample_data >tbody').html(html);
                        }

                    },
                    error: function () {
                    }
                })
            }
        });

        //***********for delete section***********
        $(document).on('click', '.delete', function () {
            var id = $(this).data('id');
            console.log('jj', id);
            $.ajax({
                url: "/ajax/delete/userdata/" + id,
                method: "DELETE",
                contentType: 'application/json',
                success: function (data) {
                    console.log('ffffffff');
                    $("#adata").click();
                }
            });


        });

        //********for edit data*******

        // <button type="button" class="btn btn-warning btn-sm edit" data-id="`+ data.data[count]._id + `">Edit</button>

        // $(document).on('click', '.edit', function(){

        // var id = $(this).data('id');

        // $('#dynamic_modal_title').text('Edit Data');

        // $('#action').val('Edit');

        // $('#action_button').text('Edit');

        // $('#action_modal').modal('show');

        // $.ajax({
        //     url:"http://localhost:3000/sample_data/action",
        //     method:"POST",
        //     data:{id:id, action:'fetch_single'},
        //     dataType:"JSON",
        //     success:function(data)
        //     {
        //         $('#first_name').val(data.first_name);
        //         $('#last_name').val(data.last_name);
        //         $('#gender').val(data.gender);
        //         $('#age').val(data.age);
        //         $('#id').val(data.id);
        //     }
        // });

        // });

    </script>
</head>

<body>
    <h1>Ajax Nodejs Crud Application</h1>
    <br />
    <form id="form1" method="POST">
        <table style="margin-left:auto; margin-right:auto;">
            <tr>
                <td><label>UserName</label></td>
                <td><input class="form-control" type="text" name="username" id="username" required></td>
            </tr>
            <tr>
                <td><label>Fullname</label></td>
                <td><input class="form-control" type="text" name="fullname" id="fullname" required></td>
            </tr>
            <tr>
                <td><label>Age</label></td>
                <td><input class="form-control" type="Number" name="age" id="age" required></td>
            </tr>
        </table>
        <br />
        <button type="Submit" id="add" class="btn btn-success">Submit</button>
    </form>
    <br />
    <button id="adata" class="btn btn-primary">Show</button>
    <br />

    <div class="card-body">
        <div class="table-responsive">
            <table class="table table-striped table-bordered" id="sample_data">
                <thead>
                    <tr>
                        <th>User Name</th>
                        <th>Full Name</th>
                        <th>Age</th>
                        <th>Action</th>
                    </tr>
                </thead>
                <tbody></tbody>
            </table>
        </div>
    </div>



    <!-- Modal -->
    <div class="modal fade" id="exampleModal" tabindex="-1" aria-labelledby="exampleModalLabel" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="exampleModalLabel">Update data</h5>
                    <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                        <span aria-hidden="true">&times;</span>
                    </button>
                </div>
                <div class="modal-body">
                    <form id="form1" method="POST">
                        <table style="margin-left:auto; margin-right:auto;">
                            <tr>
                                <td><label>UserName</label></td>
                                <td><input class="form-control" type="text" name="username" id="username" required></td>
                            </tr>
                            <tr>
                                <td><label>Fullname</label></td>
                                <td><input class="form-control" type="text" name="fullname" id="fullname" required></td>
                            </tr>
                            <tr>
                                <td><label>Age</label></td>
                                <td><input class="form-control" type="Number" name="age" id="age" required></td>
                            </tr>
                        </table>
                        <br />
                        <button type="Submit" id="add" class="btn btn-success">Submit</button>
                    </form>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-dismiss="modal">update</button>

                </div>
            </div>
        </div>
    </div>






    <script src="https://cdn.jsdelivr.net/npm/bootstrap@4.6.2/dist/js/bootstrap.bundle.min.js"
        integrity="sha384-Fy6S3B9q64WdZWQUiU+q4/2Lc9npb8tCaSX9FK7E8HnRr0Jz8D6OP9dO5Vg3Q9ct"
        crossorigin="anonymous"></script>
</body>

</html>